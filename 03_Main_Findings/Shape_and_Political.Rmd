---
title: "Shape and Political"
author: "Yuning Wu"
date: "2022-12-08"
output: html_document
---

```{r}
library(tidyverse)
library(plotly)
library(ggrepel)
library(ggalluvial)
```

```{r}
ufo <- read_csv("UFO_and_Weather.csv")
```

# Shape
```{r}
us_pop <- read_csv("2019_Census_US_Population_Data_By_State_Lat_Long.csv")
state <- data.frame(state.abb, state.name)

us_pop1 <- us_pop %>% 
  left_join(state, by = c("STATE" = "state.name"))

us_pop1$state.abb[us_pop1["STATE"] == "District of Columbia"] = "DC"
```

```{r}
ufo3 <- ufo %>% 
  inner_join(us_pop1, by = c("state" = "state.abb")) %>% 
  filter(shape != "light") %>% 
  group_by(state, shape) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n)) %>% 
  top_n(1, n) %>% 
  filter(shape != "unknown" & shape != "other" )

#NE has circle, oval, triangle all the same counts
```

## Plot 1
```{r}
ggplot(data = ufo3_3, mapping = aes(y = n, axis1 = state, axis2 = shape, 
                                               fill = case_when(shape == "circle" ~ "circle",
                                                                shape == "triangle" ~ "triangle",
                                                                TRUE ~ "other")))+
  geom_alluvium()+
  # geom_stratum(width = 1/4, fill = "white", color = "black") +
  # geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  theme_minimal()+
  scale_fill_manual(values = c("purple", "grey", "darkgreen"))+
  guides(fill=guide_legend(title="Shape"))+
  ggtitle("UFO Sighting Shapes in Each State")+
  ylab("Number of Sightings")+
  theme(axis.text.y = element_text(size=8), 
        axis.title=element_text(size=10), 
        plot.title = element_text(size = 15, hjust = 0.5),
        axis.text.x = element_blank(),
        axis.ticks.y = element_line(),
        legend.title = element_text(size=10), 
        legend.text = element_text(size=8))
  
ggsave("shapes_allu.png")
```

## Plot 2
```{r}
colorScale <- data.frame(z=c("circle", "triangle", "oval", "fireball", "sphere"),col=c("#440053","#440053","#FDE624","#FDE624", "FDB624"))
colorScale$col <- as.character(colorScale$col)

l <- list(color = toRGB("white"), width = 2)
g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  showlakes = TRUE,
  lakecolor = toRGB('white')
)
fig <- plot_geo(ufo3, locationmode = 'USA-states')
fig <- fig %>% add_trace(
    x = ~state, y = ~state, locations = ~state, text = ~n,
    type = 'scatter', mode = 'markers', symbol = ~shape, symbols = c('circle', 'hexagram', 'diamond-tall', 'circle-x-open', 'triangle-up'), color = ~shape, marker = list(size = 12)
  )
fig <- fig %>% colorbar(title = "proportions")
fig <- fig %>% layout(
    title = 'Shapes Reported From UFO Sightings in the US Between 2015-2019',
    geo = g
  )

fig
```


# Political
```{r}
ufo4 <- ufo %>% 
  inner_join(ufo2, by = c("state")) %>% 
  left_join(state, by = c("state" = "state.abb")) %>% 
  left_join(political, by = c("state.name" = "State")) %>% 
  group_by(state) %>%
  # summarise(n = n(), `Republican/lean Rep.` = `Republican/lean Rep.`)
  mutate(n = n()) %>% 
  distinct(state, .keep_all=TRUE) %>% 
  select(state, proportion, Republican, Democrat)
```

```{r}
ufo4 <- ufo4 %>% 
  mutate(party = case_when(Republican - Democrat > 0.02 ~ "Republican",
                             Republican - Democrat < -0.02 ~ "Democrat",
                             TRUE ~ "Swing"),
         diff = abs(Republican - Democrat))
```

## Plot 3
```{r}
my_colors <- c("Democrat" = "#0000FF", "Republican" = "#FF0000", "Swing" = "#00FF00")
x <- ufo4 %>% 
  drop_na() %>% 
  ggplot()+
  geom_point(aes(x = party, y = proportion, color = party, size = diff), alpha = 0.5)+
  geom_text_repel(data=subset(ufo4, state != "DC" & (proportion > 0.16 | proportion < 0.03)),
            aes(party,proportion,label=state),
            nudge_x = 0.2, vjust = 0, size = 3)+
  scale_color_manual(values = my_colors)+
  theme_minimal()+
  ggtitle("Self-identified Political Party Affilations and Proportions of \nUFO sightings per 1000 State Residents")+
  ylab("Proportions of UFO Sightings \nper 1000 State Residents")+
  xlab("Party Affiliation")+
  guides(size=guide_legend(title="Affiliation Strength"), color = guide_legend(title="Party Affiliation"))
x
ggsave("politics.png")
```

